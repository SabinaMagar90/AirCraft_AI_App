<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Recommendation</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>Recommend Similar Aircraft</h1>
    
    <!-- Back button -->
    <form action="/" method="get" style="margin-bottom: 20px;">
      <button type="submit" class="btn">Back</button>
    </form>

    <form method="POST" class="card">
      <label>Desired Altitude (ft)</label>
      <input name="desired_alt" type="number" step="1" required value="{{ request.form.get('desired_alt', 30000) }}">

      <label>Desired Speed (mph)</label>
      <input name="desired_mph" type="number" step="0.1" required value="{{ request.form.get('desired_mph', 450) }}">

      <label>Filter by Manufacturer (optional)</label>
      <select name="manufacturer">
        <option value="" {% if request.form.get('manufacturer') == "" %}selected{% endif %}>(no filter)</option>
        {% for m in manufacturers %}
          <option value="{{ m }}" {% if request.form.get('manufacturer') == m %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>

      <label>Filter by State (optional)</label>
      <select name="reg_state">
        <option value="" {% if request.form.get('reg_state') == "" %}selected{% endif %}>(no filter)</option>
        {% for s in states %}
          <option value="{{ s }}" {% if request.form.get('reg_state') == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>

      <button class="btn" type="submit">Recommend</button>
    </form>

    {% if recommendations %}
      <div class="result">
        <h2>Top Recommendations</h2>
        <table>
          <thead>
            <tr>
              <th>Tail</th>
              <th>Manufacturer</th>
              <th>Model</th>
              <th>State</th>
              <th>Avg Alt</th>
              <th>Avg mph</th>
              <th>Flight Count</th>
              <th>Similarity</th>
            </tr>
          </thead>
          <tbody>
            {% for r in recommendations %}
              <tr>
                <td>{{ r.tail_number }}</td>
                <td>{{ r.manufacturer }}</td>
                <td>{{ r.model }}</td>
                <td>{{ r.reg_state }}</td>
                <td>{{ r.avg_alt|round(2) }}</td>
                <td>{{ r.avg_mph|round(2) }}</td>
                <td>{{ r.flight_count }}</td>
                <td>{{ r.similarity|round(4) }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
</body>
</html>
